
var fonts={};

fonts["large"]={
    metrics:{
        width:13,
        height:12,
        spacing:2
    },
    order:[],
    glyphs:{
        "A":[
            "     ###     ",
            "     #.#     ",
            "    #...#    ",
            "    #.#.#    ",
            "   #.# #.#   ",
            "   #.# #.#   ",
            "  #.#   #.#  ",
            "  #.#####.#  ",
            " #.........# ",
            " #.#######.# ",
            "#.#       #.#",
            "###       ###",
        ],
        "B":[
            "###########  ",
            "#..........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#########.#",
            "#..........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            "#..........# ",
            "###########  ",
        ],
        "C":[
            "  ###########",
            " #..........#",
            "#.###########",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.###########",
            " #..........#",
            "  ###########",
        ],
        "D":[
            "###########  ",
            "#..........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            "#..........# ",
            "###########  ",
        ],
        "E":[
            "############ ",
            "#..........# ",
            "#.########## ",
            "#.#          ",
            "#.########   ",
            "#........#   ",
            "#.########   ",
            "#.#          ",
            "#.#          ",
            "#.###########",
            "#...........#",
            "#############",
        ],
        "F":[
            "############ ",
            "#..........# ",
            "#.########## ",
            "#.#          ",
            "#.#          ",
            "#.########   ",
            "#........#   ",
            "#.########   ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "###          ",
        ],
        "G":[
            "  ###########",
            " #..........#",
            "#.###########",
            "#.#          ",
            "#.#          ",
            "#.#    ######",
            "#.#    #....#",
            "#.#    ####.#",
            "#.#       #.#",
            "#.#########.#",
            " #.........# ",
            "  #########  ",
        ],
        "H":[
            "###       ###",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            "#...........#",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "###       ###",
        ],
        "I":[
            "#############",
            "#...........#",
            "######.######",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "######.######",
            "#...........#",
            "#############",
        ],
        "J":[
            "          ###",
            "          #.#",
            "          #.#",
            "          #.#",
            "          #.#",
            "          #.#",
            "###       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            " #.........# ",
            "  #########  ",
        ],
        "K":[
            "###       #  ",
            "#.#      #.# ",
            "#.#     #.#  ",
            "#.#    #.#   ",
            "#.#####.#    ",
            "#......#     ",
            "#.####..#    ",
            "#.#   #..#   ",
            "#.#    #..#  ",
            "#.#     #..# ",
            "#.#      #..#",
            "###       ###",
        ],
        "L":[
            "###          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "#.###########",
            "#...........#",
            "#############",
        ],
        "M":[
            "###       ###",
            "#..#     #..#",
            "#...#   #...#",
            "#.#..# #..#.#",
            "#.##..#..##.#",
            "#.# #...# #.#",
            "#.#  #.#  #.#",
            "#.#   #   #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "###       ###",
        ],
        "N":[
            "###       ###",
            "#..#      #.#",
            "#...#     #.#",
            "#.#..#    #.#",
            "#.##..#   #.#",
            "#.# #..#  #.#",
            "#.#  #..# #.#",
            "#.#   #..##.#",
            "#.#    #..#.#",
            "#.#     #...#",
            "#.#      #..#",
            "###       ###",
        ],
        "O":[
            "  #########  ",
            " #.........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            " #.........# ",
            "  #########  ",
        ],
        "P":[
            "###########  ",
            "#..........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            "#..........# ",
            "#.#########  ",
            "#.#          ",
            "#.#          ",
            "#.#          ",
            "###          ",
        ],
        "Q":[
            "  #########  ",
            " #.........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#     # #.#",
            "#.#    #.##.#",
            "#.#   #.....#",
            "#.#    #....#",
            "#.########..#",
            " #..........#",
            "  ########## ",
        ],
        "R":[
            "###########  ",
            "#..........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            "#..........# ",
            "#.#####..##  ",
            "#.#    #..#  ",
            "#.#     #..# ",
            "#.#      #..#",
            "###       ###",
        ],
        "S":[
            "  ########## ",
            " #.........# ",
            "#.########## ",
            "#.#          ",
            "#.#########  ",
            " #.........# ",
            "  #########.#",
            "          #.#",
            "          #.#",
            "###########.#",
            "#..........# ",
            "###########  ",
        ],
        "T":[
            "#############",
            "#...........#",
            "######.######",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     ###     ",
        ],
        "U":[
            "###       ###",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            " #.........# ",
            "  #########  ",
        ],
        "V":[
            "###       ###",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#..#     #..#",
            " #..#   #..# ",
            "  #..# #..#  ",
            "   #..#..#   ",
            "    #...#    ",
            "     ###     ",
        ],
        "W":[
            "###       ###",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#  ###  #.#",
            "#.#  #.#  #.#",
            "#.#  #.#  #.#",
            "#.####.####.#",
            " #.........# ",
            "  #########  ",
        ],
        "X":[
            "###       ###",
            "#..#     #..#",
            " #..#   #..# ",
            "  #..# #..#  ",
            "   #..#..#   ",
            "    #...#    ",
            "    #...#    ",
            "   #..#..#   ",
            "  #..# #..#  ",
            " #..#   #..# ",
            "#..#     #..#",
            "###       ###",
        ],
        "Y":[
            "###       ###",
            "#..#     #..#",
            " #..#   #..# ",
            "  #..# #..#  ",
            "   #..#..#   ",
            "    #...#    ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     ###     ",
        ],
        "Z":[
            "#############",
            "#...........#",
            "#########..# ",
            "       #..#  ",
            "      #..#   ",
            "     #..#    ",
            "    #..#     ",
            "   #..#      ",
            "  #..#       ",
            " #..#########",
            "#...........#",
            "#############",
        ],
        "0":[
            "  #########  ",
            " #.........# ",
            "#.#########.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#       #.#",
            "#.#########.#",
            " #.........# ",
            "  #########  ",
        ],
        "1":[
            "     ###     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     ###     ",
        ],
        "!":[
            "     ###     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     #.#     ",
            "     ###     ",
            "             ",
            "     ###     ",
            "     #.#     ",
            "     ###     ",
        ],
        ".":[
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "     ###     ",
            "     #.#     ",
            "     ###     ",
        ],
        "?":[
            " ##########  ",
            " #.........# ",
            " #########.# ",
            "         #.# ",
            "      ####.# ",
            "     #.....# ",
            "     #. ###  ",
            "     ###     ",
            "             ",
            "     ###     ",
            "     #.#     ",
            "     ###     ",
        ],
        ">":[
            "   ####      ",
            "    #..#     ",
            "     #..#    ",
            "      #..#   ",
            "       #..#  ",
            "        #..# ",
            "        #..# ",
            "       #..#  ",
            "      #..#   ",
            "     #..#    ",
            "    #..#     ",
            "   ####      ",
	],
        "<":[
            "      ####   ",
            "     #..#    ",
            "    #..#     ",
            "   #..#      ",
            "  #..#       ",
            " #..#        ",
            " #..#        ",
            "  #..#       ",
            "   #..#      ",
            "    #..#     ",
            "     #..#    ",
            "      ####   ",
        ],
        " ":[
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
            "             ",
        ]
    }
};

fonts["small"]={
    metrics:{
        width:5,
        height:6,
        spacing:2
    },
    order:[],
    glyphs:{
        "-":[
            "     ",
            "     ",
            "     ",
            "#####",
            "     ",
            "     ",
        ],
        "0":[
            "#####",
            "#   #",
            "# # #",
            "# # #",
            "#   #",
            "#####",
        ],
        "1":[
            " ##  ",
            "  #  ",
            "  #  ",
            "  #  ",
            "  #  ",
            "#####",
        ],
        "2":[
            " ####",
            "    #",
            "#####",
            "#    ",
            "#    ",
            "#####",
        ],
        "3":[
            " ### ",
            "   # ",
            "#####",
            "    #",
            "    #",
            "#####",
        ],
        "4":[
            "    #",
            "#   #",
            "#   #",
            "#####",
            "    #",
            "    #",
        ],
        "5":[
            "###  ",
            "#    ",
            "#####",
            "    #",
            "    #",
            "#####",
        ],
        "6":[
            "###  ",
            "#    ",
            "#####",
            "#   #",
            "#   #",
            "#####",
        ],
        "7":[
            "#####",
            "    #",
            "    #",
            "    #",
            "    #",
            "    #",
        ],
        "8":[
            " ### ",
            " # # ",
            "#####",
            "#   #",
            "#   #",
            "#####",
        ],
        "9":[
            "#####",
            "#   #",
            "#   #",
            "#####",
            "    #",
            "    #",
        ],
        "A":[
            "#####",
            "#   #",
            "#   #",
            "#####",
            "#   #",
            "#   #",
        ],
        "B":[
            "#### ",
            "#  # ",
            "#####",
            "#   #",
            "#   #",
            "#####",
        ],
        "C":[
            "#####",
            "#    ",
            "#    ",
            "#    ",
            "#    ",
            "#####",
        ],
        "D":[
            "#### ",
            "#   #",
            "#   #",
            "#   #",
            "#   #",
            "#### ",
        ],
        "E":[
            "#####",
            "#    ",
            "#### ",
            "#    ",
            "#    ",
            "#####",
        ],
        "F":[
            "#### ",
            "#    ",
            "#### ",
            "#    ",
            "#    ",
            "#    ",
        ],
        "G":[
            "#####",
            "#    ",
            "#    ",
            "#  ##",
            "#   #",
            "#####",
        ],
        "H":[
            "#   #",
            "#   #",
            "#####",
            "#   #",
            "#   #",
            "#   #",
        ],
        "I":[
            "#####",
            "  #  ",
            "  #  ",
            "  #  ",
            "  #  ",
            "#####",
        ],
        "J":[
            "    #",
            "    #",
            "    #",
            "#   #",
            "#   #",
            "#####",
        ],
        "K":[
            "#  # ",
            "#  # ",
            "#####",
            "#   #",
            "#   #",
            "#   #",
        ],
        "L":[
            "#    ",
            "#    ",
            "#    ",
            "#    ",
            "#    ",
            "#####",
        ],
        "M":[
            "#####",
            "# # #",
            "# # #",
            "#   #",
            "#   #",
            "#   #",
        ],
        "N":[
            "#   #",
            "##  #",
            "# # #",
            "#  ##",
            "#   #",
            "#   #",
        ],
        "O":[
            "#####",
            "#   #",
            "#   #",
            "#   #",
            "#   #",
            "#####",
        ],
        "P":[
            "#####",
            "#   #",
            "#   #",
            "#####",
            "#    ",
            "#    ",
        ],
        "Q":[
            "#####",
            "#   #",
            "#   #",
            "#   #",
            "#  ##",
            "#####",
        ],
        "R":[
            "#####",
            "#   #",
            "#   #",
            "#####",
            "#  # ",
            "#  # ",
        ],
        "S":[
            "#####",
            "#    ",
            "#####",
            "    #",
            "    #",
            "#####",
        ],
        "T":[
            "#####",
            "  #  ",
            "  #  ",
            "  #  ",
            "  #  ",
            "  #  ",
        ],
        "U":[
            "#   #",
            "#   #",
            "#   #",
            "#   #",
            "#   #",
            " ### ",
        ],
        "V":[
            "#   #",
            "#   #",
            "#   #",
            "#   #",
            " # # ",
            "  #  ",
        ],
        "W":[
            "#   #",
            "#   #",
            "#   #",
            "# # #",
            "# # #",
            "#####",
        ],
        "X":[
            "#   #",
            " # # ",
            "  #  ",
            " # # ",
            "#   #",
            "#   #",
        ],
        "Y":[
            "#   #",
            "#   #",
            " # # ",
            "  #  ",
            "  #  ",
            "  #  ",
        ],
        "Z":[
            "#####",
            "   # ",
            "  #  ",
            " #   ",
            "#    ",
            "#####",
        ],
        ".":[
            "     ",
            "     ",
            "     ",
            "     ",
            " ##  ",
            " ##  ",
        ],
        ",":[
            "     ",
            "     ",
            "     ",
            " ##  ",
            "  #  ",
            "  #  ",
        ],
        "'":[
            "  ## ",
            "   # ",
            "     ",
            "     ",
            "     ",
            "     ",
        ],
        "!":[
            " #   ",
            " #   ",
            " #   ",
            " #   ",
            "     ",
            " #   ",
        ],
        " ":[
            "     ",
            "     ",
            "     ",
            "     ",
            "     ",
            "     ",
        ],
    }
};

function canvas_text_init() {
    prop.canvas.text={};
    prop.canvas.text.canvases={}; // one for each font size

    canvas_text_generate();
}

function canvas_text_generate(font,inverse) {
    if(font == undefined) {
        for(var i in fonts) {
            canvas_text_generate(i,false);
            canvas_text_generate(i,true);
        }
    } else {
        var c=document.createElement("canvas");
        f=fonts[font];
        var glyphs=[];
        for(var i in f.glyphs) {
            glyphs.push([i,f.glyphs[i]]);
        }
	var s=prop.canvas.scale;
        c.width=f.metrics.width*glyphs.length*s;
        c.height=f.metrics.height*s;
        var cc=c.getContext("2d");
        for(var i=0;i<glyphs.length;i++) {
            var xoffs=i*f.metrics.width;
            fonts[font].order.push(glyphs[i][0]);
            for(var row=0;row<f.metrics.height;row++) {
                for(var item=0;item<f.metrics.width;item++) {
                    if(glyphs[i][1][row][item] == "#") {
			if(inverse)
			    cc.fillStyle="#000";
			else
			    cc.fillStyle="#fff";
		    } else if(glyphs[i][1][row][item] == ".") {
			continue;
			cc.fillStyle="";
		    } else {
			continue;
		    }
                    cc.fillRect((xoffs+item)*s,row*s,1*s,1*s);
                }
            }
        }
	if(inverse)
            prop.canvas.text.canvases[font+"-inverse"]=c;
	else
            prop.canvas.text.canvases[font]=c;
    }
}

function canvas_text_char(cc,x,y,c,font) {
    c=c.toUpperCase();
    var f=fonts[font.split("-inverse")[0]];
    var ci=f.order.indexOf(c);
    var s=prop.canvas.scale;
    cc.drawImage(prop.canvas.text.canvases[font],
                 ci*f.metrics.width*s,0,f.metrics.width*s,f.metrics.height*s,
                 x,y,f.metrics.width*s,f.metrics.height*s);

//    destination_canvas.drawImage(source_canvas,source_x,source_y,source_width,source_height,
//				 dest_x,dest_y,dest_width,dest_height);
}

function canvas_text_metrics(text,font) {
    font=font.split("-inverse")[0];
    var f=fonts[font];
    var s=prop.canvas.scale;
    var tl=text.length;
    return([((f.metrics.width*tl)+(f.metrics.spacing)*(tl-1))*s,
	    (f.metrics.height+f.metrics.spacing)*s]);
}

function canvas_text_print_ll(cc,x,y,text,font) {
    var f=fonts[font.split("-inverse")[0]];
    var s=prop.canvas.scale;
    for(var i=0;i<text.length;i++) {
        var xoffs=(i*(f.metrics.width+f.metrics.spacing)*s+x);
        canvas_text_char(cc,xoffs,y,text[i],font);
    }
}

function canvas_text_print(cc,x,y,text,font,align) {
    var xoffs=0;
    var yoffs=0;
    var m=canvas_text_metrics(text,font);
    var s=prop.canvas.scale;
    if(align == "left") align="lb";
    if(align == "right") align="rb";
    if(align == "top") align="lt";
    if(align == "bottom") align="lb";
    if(align[0] == "r") {
	xoffs=-m[0];
    } else if(align[0] == "c") {
	xoffs=-m[0]/2;
    }
    if(align[1] == "b") {
	yoffs=-m[1]*s;
    } else if(align[1] == "c") {
	yoffs=(-m[1]*s)/2;
    }
    x+=xoffs;
    y+=yoffs;
    canvas_text_print_ll(cc,x,y,text,font);
}
